{% comment %} {% extends "HtmlFolder/base.html" %} {% endcomment %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    {% block title %}
    <title> Device Information</title>
    {% endblock %}

    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    
    <link href="static/assets/img/favicon.png" rel="icon">
    <link href="static/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Jost:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
        <!-- Template Main CSS File -->
    {% load static %}
   
    <link rel="stylesheet"  href="{% static 'assets/css/style.css' %}">
    {% comment %} {% load static %}
    <link rel="stylesheet"  href="{% static 'assets/css/bootstrap.min.css' %}"> {% endcomment %}

    <!-- Vendor CSS Files -->
    {% load static %}
    <link  rel="stylesheet" href="{% static 'assets/vendor/aos/aos.css' %}">
    {% load static %}
    <link  rel="stylesheet" href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css'%}">
    {% load static %}
    <link  rel="stylesheet" href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css'%}">
    {% load static %}
    <link  rel="stylesheet" href="{% static 'assets/vendor/boxicons/css/boxicons.min.css'%}">
    {% load static %}
    <link  rel="stylesheet" href="{% static 'assets/vendor/glightbox/css/glightbox.min.css '%}">
    {% load static %}
    <link  rel="stylesheet" href="{% static 'assets/vendor/remixicon/remixicon.css '%}">
    {% load static %}
    <link href="{% static 'assets/vendor/swiper/swiper-bundle.min.css '%}" rel="stylesheet">

    {% load static %}
    <link href="{% static 'dist/apexcharts.css'%}" rel="stylesheet">

    {% comment %} {% load static %}
    <link href="{% static 'PdfJS/apexcharts.css'%}" rel="stylesheet"> {% endcomment %}

    <style>
        .highcharts-credits{
            display:none !important;
        }
        .canvasjs-chart-credit{
            display:none !important; 
        }
    </style>

</head>
<body>

    
    {% block content %}
    <div class="container-fluid">
       
<div class="row">
    <span class="col-md-6" style="    margin-left: auto;
    text-align: left;">
    <input  type="button" value="Go Back" onclick="goBack()">
</span>

    <span class="col-md-6" style="    margin-left: auto;
    text-align: right;">
    
    <button class="btn btn-primary"  style=" width:fit-content;    " id="Site_id" onclick="location.href='/Get_Device_Data';">Device Data</button>
    <button class="btn btn-primary" style=" width:fit-content; margin-right:8px;    " id ="DeviceSettingId" onclick="location.href='/Show_device_Setting';">Show Device Setting</button>    
    <button class="btn btn-primary" style=" width:fit-content; margin-right:8px;    "  id="SettingId" onclick="location.href='/Get_Setting_Command';">Setting Command</button>

   
   
</div>
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">

                            <div class="col-md-12">
                                <div class="row">
                                    
                                <div class="col-md-6" style="border-right:2px solid grey;">
                                    <div class="row">
                                        <div >
                                            <h4><center><b> Site Details </b></center> </h4>
                                        </div>

                                        {% comment %} <div id="UserChart" style="width: 100%; height: 200px; "></div> {% endcomment %}
                                        {% comment %} <table class="table">
                                            <tr>
                                                <td style="text-align:left;">Name :</td>
                                                <td style="text-align:left;" id="SiteName">dehradun</td>
                                            </tr>
                                           
                                            <tr>
                                                <td style="text-align:left;">IMEI Number :</td>
                                                <td style="text-align:left;" id="imeiid">2345677653</td>
                                            </tr>
                                            <tr>
                                                <td style="text-align:left;">Mobile Number :</td>
                                                <td style="text-align:left;" id="mobileid">9999999999</td>
                                            </tr>
                                            <tr>
                                                <td style="text-align:left;">Address :</td>
                                                <td style="text-align:left;" id="Addressid">Prayagraj</td>
                                            </tr>
                                            
                                        </table> {% endcomment %}
                                         <div class="mt-4">
                                            <div class="text-muted d-flex justify-content-between mb-2">
                                                <span><div class="badge bg-primary"></div>Name :</span>
                                                <span><strong id="SiteName" >dehradun/l</strong></span>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <div class="text-muted d-flex justify-content-between mb-2">
                                                <span><div class="badge bg-warning "></div>IMEI Number :</span>
                                                <span><strong id="imeiid">2345677653</strong></span>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <div class="text-muted d-flex justify-content-between mb-2">
                                                <span><div class="badge bg-success "></div>Mobile Number :</span>
                                                <span><strong id="mobileid">1433445545</strong></span>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <div class="text-muted d-flex justify-content-between mb-2">
                                                <span><div class="badge bg-danger "></div>Address :</span>
                                                <span><strong id="Addressid">Prayagraj</strong></span>
                                            </div>
                                        </div> 
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="row">
                                        <div >
                                            <h4><center><b> Device Details </b></center> </h4>
                                        </div>
                                        <div class="mt-4">
                                            <div class="text-muted d-flex justify-content-between mb-2">
                                                <span><div class="badge bg-primary "><img src="assets/img/icons/chl.png " style="height: 20px; "></div> Status</span>
                                                <span><strong id="DStatus">1.5 mg/l</strong></span>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <div class="text-muted d-flex justify-content-between mb-2">
                                                <span><div class="badge bg-warning "><img src="assets/img/icons/temp.png " style="height: 20px; "></div> Chlorine</span>
                                                <span><strong id="chlorineid">70 F</strong></span>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <div class="text-muted d-flex justify-content-between mb-2">
                                                <span><div class="badge bg-success "><img src="assets/img/icons/turb.png " style="height: 20px; "></div> WaterPressure</span>
                                                <span><strong id="waterPressureid">30 NTU</strong></span>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <div class="text-muted d-flex justify-content-between mb-2">
                                                <span><div class="badge bg-danger "><img src="assets/img/icons/ph.png " style="height: 20px; "></div> Battery_Percentage</span>
                                                <span><strong id="bettery_Perid">7.5 pH</strong></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                </div>
            </div>
     

        <div class="row">

            <div class="col-4 " style="height:400px">
                <div class="card">
                    <div class="card-body">
                        <div class="row  ">
                            <div class="col-12 ">
                                <strong>Water Chlorine Quality</strong>
                                <hr>
                            </div>

                        </div>

                        <div class="row">
                            <canvas id="myGaugeChart" ></canvas>

                            {% comment %} <div class="col-12 " style="position: relative; ">
                                <h5 class="cb ">Excellent</h5>
                                <p style="float: left; display: block; width: calc(100% - 220px); ">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt.
                                </p>
                                <img src="assets/img/qualityMeter.png " style="height: 200px; float: right; ">
                                <img src="assets/img/qualityMeterPin.png " class="meterPin ">
                            </div> {% endcomment %}
                     
                          <div style="margin-top:25px;">
                            <button id="chlorine_button" style="border:none;width: 30px;margin-right:6px; height: 23px;"></button>
                            <label id="chlorine_range" style="width:50%;">chlorine</label>
                          </div>
                        </div>
                        
                    </div>
                </div>
            </div>

            <div class="col-8 ">
                <div class="card ">
                        <div class="  ">
                            <div id="ChlorineChartContainer" style="height: 350px; width: 100%;">
                            </div>
                        </div>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="col-4 "style="height:320px">
                <div class="card">
                    <div class="card-body">
                        <div class="row  "> 
                            <div class="col-12 ">
                                <strong>Water Pressure Quality</strong>
                                <hr>
                            </div>
                        </div>

                        

                        <div class="row ">
                            <div id="myGaugeChartP" style="height:320px" ></div>
                            {% comment %} <div class="col-12 " style="position: relative; ">
                                <h5 class="cb ">Excellent</h5>
                                <p style="float: left; display: block; width: calc(100% - 220px); ">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt.
                                </p>
                                <img src="assets/img/qualityMeter.png " style="height: 200px; float: right; ">
                                <img src="assets/img/qualityMeterPin.png " class="meterPin ">
                            </div> {% endcomment %}
                            
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-8 ">
                <div class="card ">
                    
                        <div class="" style="height:420px;">
                            <div id="PressureChartContainer"  style="height: 420px; width: 100%;">
                            </div>
                        </div>
                 
                </div>
            </div>
        </div>
        {% comment %} <div class="Data">
            <h4> Site Data </h4>
        </div>

        <div class="row">
            <div class="card">
                <table class=" table">
                    <thead>
                        <tr>
                            <th>R11</th>
                            <th>R12</th>
                            <th>R13</th>
                            <th>R14</th>
                            <th>R15</th>
                            <th>R16</th>
                            <th>R17</th>
                            <th>R18</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>    </div> {% endcomment %}
    </div>


    

    <script src="https://code.jquery.com/jquery-3.7.0.min.js "></script>
    
    <script src="https://unpkg.com/chart.js@2.8.0/dist/Chart.bundle.js"></script>
    <script src="https://unpkg.com/chartjs-gauge@0.3.0/dist/chartjs-gauge.js"></script>
    <script src="https://unpkg.com/chartjs-plugin-datalabels@0.7.0/dist/chartjs-plugin-datalabels.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-labels@1.1.0/build/chartjs-plugin-labels.min.js"></script>

    
    <script src="static/dist/apexcharts.js "></script>
    <script src="static/assets/vendor/aos/aos.js "></script>
    <script src="static/assets/vendor/bootstrap/js/bootstrap.bundle.min.js "></script>
    <script src="static/assets/vendor/glightbox/js/glightbox.min.js "></script>
    <script src="static/assets/vendor/isotope-layout/isotope.pkgd.min.js "></script>
    <script src="static/assets/vendor/swiper/swiper-bundle.min.js "></script>
    <script src="static/assets/vendor/waypoints/noframework.waypoints.js "></script>
    <script src="static/assets/vendor/php-email-form/validate.js "></script>
    <script  src="../Jquery/jquery.multiselect.js"></script>
    <script  src="../Jquery/prettify.js"></script>
 <!-- GMap  JS File -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlXeOYex9U97yKj-1ECwvWRgwHkCF6oO4&callback"></script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

    <!-- Template Main JS File -->
    <!-- Template Main JS File -->
    <script src="static/assets/js/main.js "></script>
    <script type="text/javascript" src="https://cdn.canvasjs.com/canvasjs.stock.min.js"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

    <script>
        function goBack() {
        history.back();
        }
    </script>
{% comment %} //window.location.href = "anotherpage.html?siteId=" + siteId; {% endcomment %}
<script>
    //alert(23456789);
    // Function to get the URL parameter by name
    function getParameterByName(name, url) {
      //  alert(45687);
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
   // alert(1345);
    
    // Get the site ID from the URL
    

    //console.log("Site ID: " + Site_id);

    $(document).ready(function () {
        $(function () {
        //alert(123456);
        // Define the URL for the AJAX request
        var url = "{% url 'ShowSiteDetails' %}";
        var Site_id = getParameterByName("Site_id");
        //alert(Site_id);
        // Make an AJAX POST request
           $.ajax({
            type: 'POST',
            url: url,
            data: {Site_id: Site_id},
            success: function (response) {
                console.log(response)
                if (!response["valid"]) {

                    $.each(response, function (index, data) {
                        let Name=  data[0]; 
                        let Serial=  data[2]; 
                        let MobileNo=  data[3]; 
                        let Address=  data[1];

                    $("#fullScreenModalTest").modal('show');

                    document.getElementById("SiteName").innerHTML=Name
                    document.getElementById("imeiid").innerHTML=Serial
                    document.getElementById("mobileid").innerHTML=MobileNo
                    document.getElementById("Addressid").innerHTML=Address

       
                     });//  Object.entries(data).map(entry => {
                 //}//.then(data => {
                } else {
                    // Alert for an error
                    alert("Response not valid");
                }
            },
        })   
         .catch(error => {
            console.error('Error:', error);
         });




         //var Site_id=var Site_id = getParameterByName("Site_id");
         document.getElementById("Site_id").addEventListener("click", function() {
            // Get the site ID from the button's id attribute
            var Site_id = getParameterByName("Site_id");
                // Navigate to another page with the site ID as a parameter
            window.location.href = "/Device_Data?Site_id=" + Site_id;
                    
            });
         document.getElementById("SettingId").addEventListener("click", function() {

                    // Get the site ID from the button's id attribute
            var Site_id = getParameterByName("Site_id");
                        // Navigate to another page with the site ID as a parameter
            window.location.href = "/Setting_Data?Site_id=" + Site_id;
        });

        document.getElementById("DeviceSettingId").addEventListener("click", function() {

            // Get the site ID from the button's id attribute
            var Site_id = getParameterByName("Site_id");
                // Navigate to another page with the site ID as a parameter
            window.location.href = "/Show_device_Setting?Site_id=" + Site_id;
        });








         var url = "{% url 'GetwaterDetails' %}";
         // Make an AJAX POST request
        $.ajax({
             type: 'POST',
             url: url,
             data: {Site_id: Site_id},
             success: function (response) {
                 console.log(response)
                 if (!response["valid"]) {

                     $.each(response, function (index, data) {
                        let Chlorine=  data[0]; 
                        let WaterPressure=  data[1]; 
                        let Battery_Percentage=  data[2];
                        let Status=  data[3]; 

                    $("#fullScreenModalTest").modal('show');

                    document.getElementById("DStatus").innerHTML=`<span style="color: red;">${Status}</span>`;
                    document.getElementById("chlorineid").innerHTML=Chlorine
                    document.getElementById("waterPressureid").innerHTML=WaterPressure
                    document.getElementById("bettery_Perid").innerHTML=Battery_Percentage

                    });
                } else {
                    // Alert for an error
                    alert("Response not valid");
                }
            },
        })
         .catch(error => {
            console.error('Error:', error);
         });


        var result;
        var hr ;
    // Alert for debugging purposes
    //alert(12345567);
        const now = new Date();
        const day = now.getDay(); // returns a number representing the day of the week, starting with 0 for Sunday
        const hours = now.getHours();
        hr = hours
        console.log(hours)
    // Define the URL for the AJAX request
        var url = "{% url 'Get_ChlorineChart' %}";

    // Extract state and district IDs
    //var Stateid = str;
    //var Districtid = str1;

        // Make an AJAX POST request
        $.ajax({
            type: 'POST',
            url: url,
            data:{Site_id: Site_id},
            success: function (response) {
            
                if (!response["valid"]) {
                    // Extract data fields
                //console.log(response)
                    result  = response
                    console.log(result[0][1])
                    getChlorineChart(hr,result);
                    
                

                // Loop through the response data

                } else {
                // Alert for an error
                    alert("response not valid");
                }
            },
        })

        .catch(error => {
            console.error('Error:', error);
        });

        getPressurechart(hr,Site_id);

        
        var url = "{% url 'Get_ChlorineChart' %}";
               // alert(1234567);
                $.ajax({
                    type: 'POST',
                    url: url,
                    data: { Site_id: Site_id },
                    success: function (response) {
                        //console.log("***")
                        //console.log(response)
                        data = response[0]
                        //console.log(data)
                        console.log(data[0])
                        console.log(data[1])
                        if (!response["valid"]) {
                                
                            Chlorine = data[0];
                                //var datetime =data[1];
                            var color;
                            console.log(Chlorine)
        
                        // Set color based on the Chlorine value
                            var ctx = document.getElementById("myGaugeChart").getContext("2d");
                            var chart = new Chart(ctx, {
                                type: 'gauge',
                                data: { 
                                    labels: ['Low Chlorine', 'Excellent', 'Excess Chlorine'],
                                    datasets: [{
                                        value: Chlorine,
                                        minValue: 0,
                                        data: [0.19, 0.29, 0.50], // Adjust the data range
                                        backgroundColor: ['#DAA520', 'green', 'red'],

                                        //backgroundColor: ['#EEE6FF', 'blue', '#933'],
                                    }]
                                },
        
                                options: {
                                    responsive: true,
                                    needle: {
                                        radiusPercentage: 2,
                                        widthPercentage: 3.2,
                                        lengthPercentage: 50,
                                        color: 'rgba(0, 0, 0, 1)'
                                    },
                                    valueLabel: {
        
                                        display: true,
                                         formatter: (value) => {
                                            return value;
                                        },
        
                                        color: 'rgba(255, 255, 255, 1)',
                                        //backgroundColor:'rgb(255, 204, 153)',
                                        backgroundColor: 'rgba(0, 0, 0, 1)',
                                        borderRadius: 5,
        
                                        padding: {
                                            top: 10,
                                            bottom: 20
                                        }
                                    },
                                    plugins:{
                                        datalabels: {
                                            display: true,
                                           
                                            formatter:  function (value, context) {
                                              return context.chart.data.labels[context.dataIndex];
                                            },
                                            //color: function (context) {
                                            //  return context.dataset.backgroundColor;
                                            //},
                                            //color: 'rgba(0, 0, 0, 1.0)',
                                            color: 'rgba(255, 255, 255, 1.5)',
                                            backgroundColor: null,
                                            font: {
                                              size: 13,
                                              weight: 'bold'
                                            }
                                    },
                                            
                                    labels: {
                                        generateLabels: function (chart) {
                                            return chart.data.data.map(function (value, index) {
                                                var color = chart.data.datasets[0].backgroundColor[index];
                                                return {
                                                    text: chart.data.labels[index],
                                                    display: true,
                                                    //fillStyle: color
                                                };
                                            });
                                        }
                                    },


                                  
                                
                              }
                                }
                                        
                            });
                                    
                            if (Chlorine <= 0.19){
                                document.getElementById("chlorine_button").style.background='#DAA520';
                                document.getElementById("chlorine_range").innerHTML = "Low Chlorine";
                                
                                //console.log("inside if")        
                            } else if (Chlorine>0.19 && Chlorine<=0.29){
                                document.getElementById("chlorine_button").style.background='green';
                                document.getElementById("chlorine_range").innerHTML = "Excellent";
                                
                            }else{
                                document.getElementById("chlorine_button").style.background='red';
                                document.getElementById("chlorine_range").innerHTML = "Excess Chlorine";
                                
                                    //console.log(Chlorine)
                            }
        
                              
                        } else {
        
                    // Alert for an error
                            alert("Error");
                        }
                    }
                });
        
            });
        });

    function getChlorineChart(hr,result) {
            
        var curdate  = new Date(); 
        var dataPoints = [];
        
        var stockChart = new CanvasJS.StockChart("ChlorineChartContainer",{
            theme: "light2", //"light1", "dark1", "dark2"
            //title:{
            //  text:"Chlorine Data"
            //},
            rangeSelector: {  // Adding the range selector with custom options
                
                buttons: [  // Defining custom range options
                    {
                    label: "Today", // Add a custom button for today
                    range: hr, // Set the range to 1 day
                    rangeType: "hour"
                    },
                    
                    {
                        label: "Week",
                        range: 7,
                        rangeType: "day"
                    },
                    {
                        label: "Month",
                        range: 1,  
                        rangeType: "month"
                    },
                    {
                        label: "Year",
                        range: 365,  
                        rangeType: "day"
                    },
                    {
                        label: "All",
                        range: null, // Set the range to null to include all data
                        rangeType: "all" // You can use a custom range type "all"
                    }
                    
                ],
                inputFields: {
                    enabled:false,
                }

            },
            charts: [{
                axisX: {
                    crosshair: {
                        enabled: true,
                        snapToDataPoint: true,
                        valueFormatString: "HH:mm:ss"
                    }
                },
                axisY: {
                    prefix: "",
                    crosshair: {
                        enabled: true,
                        snapToDataPoint: true,
                        valueFormatString: "##.##",
                  
                    },

                },
                toolTip: {
                   shared: true
                },
                rangeChanged: function(e) { // Remove the date selection option
                    e.chart.navigator.toggleExpand()
                },
               data: [{
                    type: "spline",
                    name: "Chlorine",
                    yValueFormatString: "00.00",
                    dataPoints : dataPoints
                }]
            }],
            navigator: {
                enabled:true
            }
            
           
        });
            //console.log("%%%%%%%%%%%%%%")
            console.log(result)
            //console.log("@@@@@@@@@@@@@@@@@@@@@@@@")
            //console.log(result[0][1])
            //let str = result[0][1]
           // str = str.replace('T',' ')
            //console.log(str)

            //console.log(typeof result[0][1])
        for(var i = 0; i < result.length; i++){
            let str = result[i][1]
            str = str.replace('T',' ')
            console.log(str)
            console.log(result[i][0])
            dataPoints.push({x: new Date(str), y: parseFloat(result[i][0])});
        }
        var minDate = dataPoints[0].x;
        var maxDate = dataPoints[dataPoints.length - 1].x;

               
        stockChart.render();

    }// end function Modal_ShowSiteDetails/



    function getPressurechart(hr,Site_id){
       // alert(Site_id);
        {% comment %} console.log(Site_id);
        console.log("edtrftgyhujik") {% endcomment %}
        var url1 = "{% url 'Get_PressureChart' %}";
        $.ajax({
            type: 'POST',
            url: url1,
            data: {Site_id:Site_id},
            success: function (response) {
                
                if (!response["valid"]) {
                        // Extract data fields
                    //console.log(response)
                    data = response
                    var dataPoints = [];
        
                    var stockChart = new CanvasJS.StockChart("PressureChartContainer",{
                    theme: "light2", //"light1", "dark1", "dark2"
                    //title:{
                    //text:"Pressue Data"
                    //},
                    rangeSelector: {  // Adding the range selector with custom options
                
                    buttons: [  // Defining custom range options
                    {
                    label: "Today", // Add a custom button for today
                    range: hr, // Set the range to 1 day
                    rangeType: "hour"
                    },
                    
                    {
                        label: "Week",
                        range: 7,
                        rangeType: "day"
                    },
                    {
                        label: "Month",
                        range: 1,  
                        rangeType: "month"
                    },
                    {
                        label: "Year",
                        range: 365,  
                        rangeType: "day"
                    },
                    {
                        label: "All",
                        range: null, // Set the range to null to include all data
                        rangeType: "all" // You can use a custom range type "all"
                    }
                    
                    ],
                    inputFields: {
                    enabled:false,
                    }

                

                    },
                charts: [{
              axisX: {
                crosshair: {
                  enabled: true,
                  snapToDataPoint: true,
                  valueFormatString: "HH:mm:ss"
                }
              },
              axisY: {
                prefix: "",
                crosshair: {
                  enabled: true,
                  snapToDataPoint: true,
                  valueFormatString: "##.##",
                  
                },

              },
              toolTip: {
                shared: true
              },
              rangeChanged: function(e) { // Remove the date selection option
                e.chart.navigator.toggleExpand()
              },
              data: [{
                type: "line",
                name: "Pressure",
                yValueFormatString: "00.00",
                dataPoints : dataPoints
              }]
            }],
            navigator: {
                enabled:true
            }
            
           
          });
   

            //console.log(typeof result[0][1])
            for(var i = 0; i < data.length; i++){
                let str = data[i][1]
                str = str.replace('T',' ')
                console.log(str)
                console.log(data[i][0])
              dataPoints.push({x: new Date(str), y: parseFloat(data[i][0])});
            }
            var minDate = dataPoints[0].x;
            var maxDate = dataPoints[dataPoints.length - 1].x;

               
            stockChart.render();
            generate_Pressure();


                    
                    
    
                    // Loop through the response data

            } else {
                    // Alert for an error
                    alert("response not valid");
                }
            },
            
            

        })
        
        
        .catch(error => {
            console.error('Error:', error);
        });
      //  console.log("@#$%")
    }


    function generate_Pressure() {
        console.log("inside generate pressure");
        console.log(data[0][0]);
        pvalue = data[0][0];
        console.log(pvalue);
    
        //value1 = 17.33;
        //console.log(typeof value1)
        //console.log(value1);

        value2 = pvalue;
        //console.log(typeof value2);
        //console.log(value2);

        value2 = Number(value2);
        //console.log(typeof value2);

        Highcharts.chart('myGaugeChartP', {

        chart: {
            type: 'gauge',
            alignTicks: false,
            plotBackgroundColor: null,
            plotBackgroundImage: null,
            plotBorderWidth: 0,
            plotShadow: false
        },

        title: {
            text:''
        },

        pane: {
            startAngle: -150,
            endAngle: 150
        },

        yAxis: [{
            min: 0,
            max: 20,
            lineColor: '#008000',
            tickColor: '#008000',
            minorTickColor: '#008000',
            offset: -25,
            lineWidth: 3,
            labels: {
                distance: -20,
                rotation: 'auto'
            },
            tickLength: 5,
            minorTickLength: 5,
            endOnTick: false
        }, {
            min: 0,
            max: 205,
            tickPosition: 'outside',
            lineColor: '#ff0000',
            lineWidth: 3,
            minorTickPosition: 'outside',
            tickColor: '#ff0000',
            minorTickColor: '#ff0000',
            tickLength: 5,
            minorTickLength: 5,
            labels: {
                distance: 12,
               rotation: 'auto'
            },
            offset: -20,
            endOnTick: false
        }],

        series: [{
            name: 'Pressure',
            data: [value2],
            dataLabels: {
                format: '<span style="color:#008000">{y} Bar</span><br/>' +
                    '<span style="color:#ff0000">{(multiply y 10.1974):.2f} meter</span>',
                backgroundColor: {
                    linearGradient: {
                        x1: 0,
                        y1: 0,
                        x2: 0,
                        y2: 1
                    },
                    stops: [
                        [0, '#008000'],
                        [1, '#FFF']
                    ]
                }
            },
            tooltip: {
                valueSuffix: ' bar'
            }
        }],
        exporting: {
            enabled: false // Disable the context menu(the three dots with options on right side of gauge chart)
        }

    });
   }



    

</script>







{% endblock %}
</body>

</html>